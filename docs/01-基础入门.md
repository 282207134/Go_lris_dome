# 01 - 基础入门

## Iris 框架简介

Iris 是一个快速、简单但功能齐全且非常高效的 Go Web 框架。它为您的下一个网站或 API 提供了一个优雅且易于使用的表达基础。

### 主要特性

- **高性能**: Iris 是最快的 Go Web 框架之一
- **简洁易用**: 提供直观的 API 设计
- **功能完整**: 包含构建 Web 应用所需的所有功能
- **中间件支持**: 丰富的中间件生态系统
- **模板引擎**: 内置多种模板引擎支持
- **WebSocket**: 原生 WebSocket 支持
- **MVC 架构**: 支持 Model-View-Controller 模式

### 项目结构说明

```
iris-cn-sample-project/
├── main.go                 # 应用程序入口文件
├── go.mod                  # Go 模块定义文件
├── go.sum                  # 依赖版本锁定文件
├── README.md               # 项目说明文档
├── config/                 # 配置文件目录
│   └── config.go           # 应用配置管理
├── controllers/            # 控制器目录
│   ├── user_controller.go  # 用户相关控制器
│   ├── auth_controller.go  # 认证相关控制器
│   └── api_controller.go   # API 示例控制器
├── middleware/             # 中间件目录
│   ├── auth.go             # 认证中间件
│   ├── cors.go             # 跨域中间件
│   ├── logger.go           # 日志中间件
│   └── recovery.go         # 恢复中间件
├── models/                 # 数据模型目录
│   ├── user.go             # 用户模型
│   └── response.go         # 响应模型
├── services/               # 服务层目录
│   ├── user_service.go     # 用户服务
│   └── auth_service.go     # 认证服务
├── utils/                  # 工具函数目录
│   ├── jwt.go              # JWT 工具
│   ├── validator.go        # 验证工具
│   └── response.go         # 响应工具
├── static/                 # 静态文件目录
│   ├── css/                # 样式文件
│   ├── js/                 # JavaScript 文件
│   └── images/             # 图片文件
├── templates/              # 模板文件目录
│   ├── layouts/            # 布局模板
│   ├── index.html          # 首页模板
│   ├── users.html          # 用户列表模板
│   └── user.html           # 用户详情模板
└── database/               # 数据库目录
    └── database.go         # 数据库初始化
```

## 快速开始

### 1. 环境要求

- Go 1.21 或更高版本
- Git（用于克隆项目）

### 2. 安装项目

```bash
# 克隆项目
git clone <项目地址>
cd iris-cn-sample-project

# 安装依赖
go mod download
```

### 3. 运行项目

```bash
# 开发模式运行
go run main.go

# 生产模式运行
go build -o iris-sample main.go
./iris-sample
```

### 4. 访问应用

- 主页: http://localhost:8080
- API 文档: http://localhost:8080/api/docs
- 健康检查: http://localhost:8080/api/health

## 核心概念

### 1. 应用程序实例

Iris 应用程序是整个 Web 应用的核心：

```go
// 创建应用实例
app := iris.New()

// 配置应用
app.Configure(iris.WithConfiguration(iris.Configuration{
    DisableInterruptHandler: false,
    EnablePathIntelligence: true,
    FireMethodNotAllowed: true,
}))

// 启动服务器
app.Listen(":8080")
```

### 2. 路由系统

Iris 提供了强大的路由系统：

```go
// 基本路由
app.Get("/", handler)
app.Post("/users", handler)
app.Put("/users/{id}", handler)
app.Delete("/users/{id}", handler)

// 路由参数
app.Get("/users/{id:int}", func(ctx iris.Context) {
    id := ctx.Params().GetInt("id")
    // 处理逻辑
})

// 路由组
api := app.Party("/api")
{
    api.Get("/users", handler)
    api.Post("/users", handler)
}
```

### 3. 中间件

中间件是处理 HTTP 请求的函数：

```go
// 全局中间件
app.Use(middleware1)
app.Done(middleware2)

// 路由级中间件
app.Get("/protected", authMiddleware, handler)

// 中间件函数示例
func authMiddleware(ctx iris.Context) {
    // 认证逻辑
    if !isAuthenticated {
        ctx.StatusCode(iris.StatusUnauthorized)
        return
    }
    ctx.Next()
}
```

### 4. 上下文处理

Context 提供了请求和响应的所有操作：

```go
func handler(ctx iris.Context) {
    // 获取请求参数
    name := ctx.URLParam("name")
    id := ctx.Params().GetInt("id")
    
    // 读取请求体
    var data MyStruct
    ctx.ReadJSON(&data)
    
    // 设置响应
    ctx.JSON(iris.Map{
        "message": "success",
        "data": data,
    })
    
    // 设置状态码
    ctx.StatusCode(iris.StatusOK)
}
```

### 5. 模板渲染

Iris 支持多种模板引擎：

```go
// 注册模板引擎
app.RegisterView(iris.HTML("./templates", ".html"))

// 渲染模板
app.Get("/", func(ctx iris.Context) {
    ctx.ViewData("title", "首页")
    ctx.View("index.html")
})

// 使用布局
app.RegisterView(iris.HTML("./templates", ".html").Layout("layouts/layout.html"))
```

## 配置管理

项目使用结构化的配置管理：

```go
type Config struct {
    Server   ServerConfig   `json:"server"`
    Database DatabaseConfig `json:"database"`
    JWT      JWTConfig      `json:"jwt"`
}

// 从环境变量加载配置
func loadConfig() *Config {
    return &Config{
        Server: ServerConfig{
            Port: getEnv("SERVER_PORT", "8080"),
            Mode: getEnv("GIN_MODE", "debug"),
        },
        // ... 其他配置
    }
}
```

## 错误处理

Iris 提供了优雅的错误处理机制：

```go
// 错误处理路由
app.OnErrorCode(iris.StatusNotFound, notFoundHandler)
app.OnErrorCode(iris.StatusInternalServerError, errorHandler)

// 恢复中间件
app.Use(recover.New())

// 自定义错误处理
func errorHandler(ctx iris.Context) {
    ctx.ViewData("error", "服务器内部错误")
    ctx.View("error.html")
}
```

## 日志记录

项目实现了自定义日志中间件：

```go
func Logger() iris.Handler {
    return func(ctx iris.Context) {
        start := time.Now()
        ctx.Next()
        duration := time.Since(start)
        
        log.Printf("%s %s %d %v", 
            ctx.Method(), 
            ctx.Path(), 
            ctx.GetStatusCode(), 
            duration)
    }
}
```

## 开发工具

### 1. 热重载

使用 `air` 工具实现热重载：

```bash
# 安装 air
go install github.com/cosmtrek/air@latest

# 运行
air
```

### 2. API 测试

使用 `curl` 或 Postman 测试 API：

```bash
# 测试 GET 请求
curl http://localhost:8080/api/hello?name=World

# 测试 POST 请求
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 3. 调试

使用 Go 的调试工具：

```bash
# 使用 delve 调试
go install github.com/go-delve/delve/cmd/dlv@latest
dlv debug main.go
```

## 最佳实践

### 1. 项目组织

- 按功能模块组织代码
- 分离业务逻辑和 HTTP 处理
- 使用服务层处理复杂业务逻辑
- 保持控制器简洁

### 2. 错误处理

- 统一错误响应格式
- 记录详细的错误日志
- 提供友好的错误信息
- 使用恢复中间件防止 panic

### 3. 安全性

- 使用 HTTPS
- 验证所有输入数据
- 实现认证和授权
- 防止常见攻击（CSRF、XSS 等）

### 4. 性能优化

- 使用连接池
- 实现缓存机制
- 优化数据库查询
- 使用压缩中间件

## 下一步

现在您已经了解了 Iris 框架的基础知识，建议继续学习：

1. [路由系统](./02-路由系统.md) - 深入学习路由配置
2. [中间件使用](./03-中间件使用.md) - 掌握中间件开发
3. [请求处理](./04-请求处理.md) - 学习各种请求处理方式
4. [响应处理](./05-响应处理.md) - 掌握响应格式化

## 相关资源

- [Iris 官方文档](https://iris-go.com/)
- [Iris GitHub 仓库](https://github.com/kataras/iris)
- [Go 语言官网](https://golang.org/)
- [Go Modules 文档](https://golang.org/cmd/go/#hdr-Modules__module_versions__and_more)